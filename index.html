<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Habitat – Create Property</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0f1115;
      color: #eaeaea;
      padding: 40px;
      max-width: 700px;
      margin: auto;
    }

    h1 { margin-bottom: 10px; }
    p { color: #b0b0b0; }

    label { display: block; margin-top: 20px; }
    input, select, button {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-top: 6px;
      border-radius: 6px;
      border: none;
    }

    input, select { background: #1b1e25; color: #fff; }
    button { background: #3b82f6; color: #fff; cursor: pointer; }
    button:hover { background: #2563eb; }

    pre {
      background: #1b1e25;
      padding: 15px;
      margin-top: 25px;
      border-radius: 6px;
      white-space: pre-wrap;
    }
  </style>
</head>

<body>

<h1>Create Property</h1>
<p>This creates a property for the Habitat network.</p>

<label>Property Type</label>
<select id="type">
  <option value="house">House</option>
  <option value="apartment">Apartment</option>
  <option value="studio">Studio</option>
  <option value="library">Library</option>
</select>

<label>Place</label>
<input id="place" placeholder="riverton">

<button id="createBtn">Create Property</button>

<pre id="output"></pre>

<!-- ✅ SUPABASE UMD LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<script>
/* =========================
   CONFIG (PASTE YOURS)
========================= */
const SUPABASE_URL = "https://tgplhoufpwpfhidxhgin.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRncGxob3VmcHdwZmhpZHhoZ2luIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMzgzMTEsImV4cCI6MjA4MzcxNDMxMX0.uN5xJq1BbZs2UUjmIJU39XycOvoxE4z1sisV4a1BoL0";

/* =========================
   SUPABASE CLIENT (ONCE)
========================= */
const supabase = supabaseJs.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* =========================
   HELPERS
========================= */
function randomId() {
  return Math.random().toString(36).substring(2, 7).toUpperCase();
}

function randomKey(type) {
  return `ADDR-${type.toUpperCase()}-${randomId()}${randomId()}`;
}

/* =========================
   MAIN ACTION
========================= */
async function createProperty() {
  const type = document.getElementById("type").value;
  const place = document.getElementById("place").value.trim().toLowerCase();
  const output = document.getElementById("output");

  if (!place) {
    alert("Enter a place name.");
    return;
  }

  const id = randomId();
  const key = randomKey(type);
  const address = `${id}.${place}.${type}.address`;

  const expires = new Date();
  expires.setDate(expires.getDate() + 100);

  const { error } = await supabase
    .from("properties")
    .insert({
      key: key,
      property_type: type,
      place: place,
      address: address,
      expires_at: expires.toISOString()
    });

  if (error) {
    output.textContent = "ERROR:\n" + error.message;
    return;
  }

  output.textContent =
`PROPERTY CREATED SUCCESSFULLY

PROPERTY KEY (SAVE THIS):
${key}

PROPERTY ADDRESS:
${address}

SERVER URL:
http://localhost:7777/property

NEXT STEPS:
1. Run the C# Property Server
2. Paste the KEY when asked
3. Paste the ADDRESS when asked
4. Keep the server running`;
}

/* =========================
   BUTTON WIRING
========================= */
document
  .getElementById("createBtn")
  .addEventListener("click", createProperty);

/* =========================
   DEBUG CONFIRMATION
========================= */
console.log("Habitat page loaded.");
console.log("Supabase client:", supabase);
</script>

</body>
</html>
