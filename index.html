<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Habitat â€“ Create Property</title>
</head>

<body>

<h1>Create Property</h1>

<select id="type">
  <option value="house">House</option>
  <option value="apartment">Apartment</option>
  <option value="studio">Studio</option>
  <option value="library">Library</option>
</select>

<input id="place" placeholder="riverton">

<button onclick="createProperty()">Create Property</button>

<pre id="output"></pre>

<!-- âœ… SUPABASE LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<!-- âœ… YOUR SCRIPT (LAST) -->
<script>
  const SUPABASE_URL = "YOUR_SUPABASE_URL";
  const SUPABASE_KEY = "YOUR_ANON_PUBLIC_KEY";

  const supabase = supabaseJs.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  );

  function randomId() {
    return Math.random().toString(36).substring(2, 7).toUpperCase();
  }

  function randomKey(type) {
    return `ADDR-${type.toUpperCase()}-${randomId()}${randomId()}`;
  }

  // ðŸ”´ THIS LINE IS CRITICAL
  window.createProperty = async function () {
    const type = document.getElementById("type").value;
    const place = document.getElementById("place").value.trim().toLowerCase();
    const output = document.getElementById("output");

    if (!place) {
      alert("Enter a place");
      return;
    }

    const id = randomId();
    const key = randomKey(type);
    const address = `${id}.${place}.${type}.address`;

    const expires = new Date();
    expires.setDate(expires.getDate() + 100);

    const { error } = await supabase
      .from("properties")
      .insert({
        key,
        property_type: type,
        place,
        address,
        expires_at: expires.toISOString()
      });

    if (error) {
      output.textContent = "Error:\n" + error.message;
      return;
    }

    output.textContent =
`PROPERTY CREATED

KEY:
${key}

ADDRESS:
${address}

SERVER URL:
http://localhost:7777/property`;
  };
</script>

</body>
</html>
